# ğŸ§  AIè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯PoCç”¨ã®LightGBMãƒ™ãƒ¼ã‚¹ã®USD/JPYä¾¡æ ¼äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã®æŠ€è¡“è¨­è¨ˆã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ“Š ã‚¿ã‚¹ã‚¯å®šç¾©

### äºˆæ¸¬ã‚¿ã‚¹ã‚¯

**3å€¤åˆ†é¡** (Multi-class Classification)

```
å…¥åŠ›:   éå»60åˆ†ã®OHLCVãƒ‡ãƒ¼ã‚¿ + ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™
å‡ºåŠ›:   3ã‚¯ãƒ©ã‚¹ã®ã„ãšã‚Œã‹
        - LONG (0)   : 1-2æ™‚é–“å¾Œã«ä¸Šæ˜‡ â†’ è²·ã„æ¨å¥¨
        - SHORT (1)  : 1-2æ™‚é–“å¾Œã«ä¸‹è½ â†’ å£²ã‚Šæ¨å¥¨
        - NO_TRADE (2): ä¸ç¢ºå®Ÿ â†’ è¦‹é€ã‚Šæ¨å¥¨
```

### ãƒ©ãƒ™ãƒ«å®šç¾©

**Forward Returnï¼ˆå‰å‘ããƒªã‚¿ãƒ¼ãƒ³ï¼‰ã‚’åŸºæº–**

```python
forward_return = (close[t+60] - close[t]) / close[t] * 100

if forward_return > +0.1%:
    label = LONG
elif forward_return < -0.1%:
    label = SHORT
else:
    label = NO_TRADE
```

**é–¾å€¤ã®æ„ç¾©:**
- Â±0.1% = ä¸€èˆ¬çš„ãªã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ + å–å¼•ã‚³ã‚¹ãƒˆ
- ã“ã‚Œã‚ˆã‚Šå°ã•ã„å‹•ãã¯åˆ©ç›Šã«ãªã‚‰ãªã„
- å®Ÿé‹ç”¨ã§ã¯èª¿æ•´ãŒå¿…è¦

---

## ğŸ¯ ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°

### 1. ãƒªã‚¿ãƒ¼ãƒ³ç³»ç‰¹å¾´é‡

```python
# å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã§éå»ã®ãƒªã‚¿ãƒ¼ãƒ³ã‚’è¨ˆç®—
return_1m  = (close[t] - close[t-1])   / close[t-1] * 100
return_5m  = (close[t] - close[t-5])   / close[t-5] * 100
return_15m = (close[t] - close[t-15])  / close[t-15] * 100
return_30m = (close[t] - close[t-30])  / close[t-30] * 100
```

**ç›®çš„:**
- ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ã‚’æ•æ‰
- çŸ­æœŸã§ã®ãƒˆãƒ¬ãƒ³ãƒ‰æ–¹å‘ã‚’æ¤œå‡º

### 2. ç§»å‹•å¹³å‡ä¹–é›¢ç‡ (SMA Deviation)

```python
# ç§»å‹•å¹³å‡ã‹ã‚‰ã®ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ä¹–é›¢
sma_5m  = close.rolling(5).mean()
sma_15m = close.rolling(15).mean()
sma_60m = close.rolling(60).mean()

sma_dev_5m  = (close - sma_5m)  / sma_5m * 100
sma_dev_15m = (close - sma_15m) / sma_15m * 100
sma_dev_60m = (close - sma_60m) / sma_60m * 100
```

**ç›®çš„:**
- å¹³å‡å€¤ã‹ã‚‰ã®ä¹–é›¢ã‚’å®šé‡åŒ–
- éåº¦ãªè²·ã‚ã‚Œ/å£²ã‚‰ã‚ŒçŠ¶æ…‹ã‚’æ¤œå‡º
- Mean Reversion ã‚·ã‚°ãƒŠãƒ«

### 3. ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ (ATR)

```python
# Average True Range - å¤‰å‹•ç‡ã‚’æ¸¬å®š
true_range = max(high - low, 
                 abs(high - close[prev]),
                 abs(low - close[prev]))

atr_15m = true_range.rolling(15).mean()
atr_30m = true_range.rolling(30).mean()
```

**ç›®çš„:**
- ãƒ¢ãƒ‡ãƒ«ã®ç¢ºåº¦ (confidence) ã«å½±éŸ¿
- ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒé«˜ã„æ™‚ã¯äºˆæ¸¬ä¿¡é ¼åº¦ã‚’ä¸‹ã’ã‚‹å ´åˆãŒã‚ã‚‹

### 4. RSI (Relative Strength Index)

```python
# Momentum ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼
delta = close.diff()
gain = delta.where(delta > 0, 0).rolling(14).mean()
loss = -delta.where(delta < 0, 0).rolling(14).mean()

rs = gain / loss
rsi = 100 - (100 / (1 + rs))
```

**ç›®çš„:**
- ã‚ªãƒ¼ãƒãƒ¼ãƒã‚¤ / ã‚ªãƒ¼ãƒãƒ¼ã‚½ãƒ¼ãƒ«ãƒ‰ã‚’æ¤œå‡º
- å€¤ã®ç¯„å›²: 0-100
  - RSI < 30: å£²ã‚‰ã‚Œã™ã â†’ åç™ºå€™è£œ
  - RSI > 70: è²·ã‚ã‚Œã™ã â†’ èª¿æ•´å€™è£œ

### 5. æ™‚é–“å¸¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

```python
# ã‚°ãƒ­ãƒ¼ãƒãƒ«ç‚ºæ›¿å¸‚å ´ã®å–¶æ¥­æ™‚é–“
hour = close.index.hour
day_of_week = close.index.dayofweek

# å–¶æ¥­æ™‚é–“å¸¯ã‚’åˆ†é¡
def get_market_session(hour):
    if 8 <= hour < 17:          # JST 08:00-17:00
        return 0  # Tokyo
    elif 15 <= hour < 24 or 0 <= hour < 2:  # GMT 15:00-24:00, 0:00-2:00
        return 1  # London (overlap)
    else:
        return 2  # New York (20:00-04:00 JST)
```

**ç›®çš„:**
- å¸‚å ´ã®æµå‹•æ€§ã‚„å‚åŠ è€…ã®é•ã„ã‚’è€ƒæ…®
- æ™‚é–“å¸¯ã”ã¨ã®ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£å·®ã‚’å­¦ç¿’

### 6. ç‰¹å¾´é‡ã‚µãƒãƒªãƒ¼

| ç‰¹å¾´é‡ | æ•° | èª¬æ˜ |
|:---|:---:|:---|
| ãƒªã‚¿ãƒ¼ãƒ³ | 4 | 1m, 5m, 15m, 30m |
| SMAä¹–é›¢ | 3 | 5m, 15m, 60m |
| ATR | 2 | 15m, 30m |
| RSI | 1 | 14æœŸé–“ |
| æ™‚é–“å¸¯ | 2 | hour, market_session |
| æ›œæ—¥ | 2 | day_of_week, is_weekend |
| **åˆè¨ˆ** | **14** | |

---

## ğŸ¤– ãƒ¢ãƒ‡ãƒ«: LightGBM

### ãƒ¢ãƒ‡ãƒ«é¸æŠã®ç†ç”±

```
LightGBMã‚’é¸ã‚“ã ç†ç”±:
âœ… é«˜é€Ÿï¼ˆå­¦ç¿’ãƒ»æ¨è«–å…±ã«ï¼‰
âœ… ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒè‰¯ã„ï¼ˆãƒãƒ¼ãƒˆPCå¯¾å¿œï¼‰
âœ… å°ã€œä¸­è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«è‰¯å¥½
âœ… æœ¬ç•ªç’°å¢ƒã¸ã®ç§»è¡ŒãŒå®¹æ˜“
âœ… ç‰¹å¾´é‡ã®é‡è¦åº¦ã‚’æŠ½å‡ºå¯èƒ½
```

### ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```yaml
objective: "multiclass"      # 3ã‚¯ãƒ©ã‚¹åˆ†é¡
num_class: 3
num_leaves: 31               # æ¨¹ã®è‘‰æ•°ï¼ˆè¤‡é›‘ã•ã®èª¿æ•´ï¼‰
max_depth: 5                 # æœ€å¤§æ·±ã•ï¼ˆæµ…ã‚ = éå­¦ç¿’ã‚’æŠ‘åˆ¶ï¼‰
learning_rate: 0.05          # å­¦ç¿’ç‡ï¼ˆä½ã„ = å®‰å®šã€æ™‚é–“ãŒã‹ã‹ã‚‹ï¼‰
min_data_in_leaf: 20         # è‘‰ã®æœ€å°ã‚µãƒ³ãƒ—ãƒ«æ•°
feature_fraction: 0.8        # å„åå¾©ã§ä½¿ã†ç‰¹å¾´é‡ã®å‰²åˆ
bagging_fraction: 0.8        # å„åå¾©ã§ä½¿ã†ãƒ‡ãƒ¼ã‚¿ã®å‰²åˆ
bagging_freq: 5              # baggingã®å®Ÿæ–½é »åº¦
num_boosting_rounds: 200     # ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ©ã‚¦ãƒ³ãƒ‰æ•°
```

### å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ

```python
# è¨“ç·´æœŸé–“: éå»7æ—¥
# ãƒ†ã‚¹ãƒˆæœŸé–“: ç›´è¿‘1æ—¥
# æ¤œè¨¼åˆ†å‰²: 80-20

train_size = 7 days Ã— 1440 min = 10,080 rows
valid_size = 1 day Ã— 1440 min = 1,440 rows
test_size = 1 day Ã— 1440 min = 1,440 rows
```

**ãƒ‡ãƒ¼ã‚¿ã®æ™‚ç³»åˆ—æ€§ã‚’ä¿æŒ:**
```
æ™‚é–“è»¸ â†’
[è¨“ç·´]  [æ¤œè¨¼]  [ãƒ†ã‚¹ãƒˆ]
(7æ—¥)  (1æ—¥)   (1æ—¥)
```

---

## ğŸ“ˆ ãƒ¢ãƒ‡ãƒ«ã®è©•ä¾¡æŒ‡æ¨™

### åˆ†é¡ç²¾åº¦

```
Accuracy = (TP + TN) / (TP + TN + FP + FN)
```

**æœŸå¾…å€¤**: 40-50%
- ãƒ©ãƒ³ãƒ€ãƒ äºˆæ¸¬: 33%ï¼ˆ3ã‚¯ãƒ©ã‚¹ï¼‰
- ã“ã®PoC: ä»–ã‚’åœ§å€’ã—ã¦ã„ãªã„ï¼ˆæ„å›³çš„ï¼‰
- æœ¬ç•ªåŒ–æ™‚ã«æ”¹å–„ã®ä½™åœ°ã‚ã‚Š

### ã‚¯ãƒ©ã‚¹åˆ¥è©•ä¾¡

```
Precision = TP / (TP + FP)         # äºˆæ¸¬ã®æ­£ç¢ºã•
Recall    = TP / (TP + FN)         # è¦‹é€ƒã—ã®å°‘ãªã•
F1-Score  = 2 Ã— (Precision Ã— Recall) / (Precision + Recall)
```

**ä¸å‡è¡¡ãƒ‡ãƒ¼ã‚¿ã®å¯¾å¿œ:**
```
ã‚¯ãƒ©ã‚¹åˆ¥ã®åˆ†å¸ƒãŒç•°ãªã‚‹å ´åˆ:
- LONG: 35%
- SHORT: 32%
- NO_TRADE: 33%

â†’ F1-Scoreã§è©•ä¾¡ï¼ˆAccuracyã‚ˆã‚Šæœ‰ç”¨ï¼‰
```

### æ··åŒè¡Œåˆ—

```
                 äºˆæ¸¬
å®Ÿéš›  LONG SHORT NO_TRADE
LONG   100   20    15
SHORT   18   95    22
NO_TRADE 12   25   88
```

---

## ğŸ”„ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ã¸ã®é“ç­‹

### ç¾åœ¨ï¼ˆãƒãƒƒãƒå­¦ç¿’ï¼‰

```
æ¯æ—¥ 1å›:
1. æ–°è¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
2. å…¨ä½“ã‚’å†å­¦ç¿’
3. ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
```

### Phase 1ï¼ˆå®šæœŸæ›´æ–°ï¼‰

```
æ¯æ™‚é–“ 1å›:
- éå»7æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã§æ–°è¦å­¦ç¿’
- ä¿¡é ¼åº¦ãŒä½ä¸‹ã—ãŸã‚‰è‡ªå‹•è¨“ç·´
```

### Phase 2ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ï¼‰

```
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ :
- äºˆæ¸¬ â†’ å®Ÿç¸¾ â†’ æ–°è¦ã‚µãƒ³ãƒ—ãƒ«ç™»éŒ²
- ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ãªå­¦ç¿’
```

---

## ğŸš¨ æ—¢çŸ¥ã®åˆ¶é™äº‹é …

### 1. ã‚¿ã‚¤ãƒ ãƒ©ã‚°

```
å®Ÿè£…ã®è¿…å»¶:
Alpha Vantage API â†’ fetch_data (1-2åˆ†)
                  â†’ feature_engineer (æ•°ç§’)
                  â†’ predict (æ•°ç§’)
                  â†’ APIå¿œç­”

åˆè¨ˆ: 2-3åˆ†ã®ãƒ©ã‚°
â†’ ã€Œ1-2æ™‚é–“å¾Œã€ã®äºˆæ¸¬ãªã®ã§è¨±å®¹ç¯„å›²
```

### 2. ç‰¹å¾´é‡ã®å†·é–‹å§‹

```
éå»60åˆ†ã®ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦
â†’ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç›´å¾Œã¯æœ€åˆã®60åˆ†ã¯äºˆæ¸¬ã§ããªã„

å¯¾å¿œ: ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„
```

### 3. å¸‚å ´ãŒé–‰å ´ã—ã¦ã„ã‚‹æ™‚é–“

```
ç‚ºæ›¿å¸‚å ´ã¯24/5ï¼ˆæœˆ-é‡‘ï¼‰
â†’ åœŸæ—¥ã«ã¯ãƒ‡ãƒ¼ã‚¿ãŒãªã„

å¯¾å¿œ:
- ç¥æ—¥ã‚’é™¤å¤–ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
- is_weekend ãƒ•ãƒ©ã‚°ã§å­¦ç¿’
```

### 4. å¤–éƒ¨ã‚·ãƒ§ãƒƒã‚¯

```
ãƒ†ãƒ­ã€çµŒæ¸ˆæŒ‡æ¨™ã®å¤§ã‚µãƒ—ãƒ©ã‚¤ã‚ºãªã©
â†’ éå»ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãå­¦ç¿’ã§ã¯äºˆæ¸¬å›°é›£

å¯¾å¿œ:
- ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ã®ã‚»ãƒ³ãƒãƒ¡ãƒ³ãƒˆåˆ†æã‚’è¿½åŠ ï¼ˆPhase 2ï¼‰
- ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒç•°å¸¸ã«é«˜ã„æ™‚ã¯ NO_TRADE æ¨å¥¨
```

---

## ğŸ§ª æ¤œè¨¼æˆ¦ç•¥

### ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ

```python
# éå»ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦å¾Œä»˜ã‘ã§æ¤œè¨¼
accuracy, precision, recall = backtest(
    data=past_7_days,
    model=trained_model
)
```

### å‰æ–¹ãƒ†ã‚¹ãƒˆï¼ˆPaper Tradingï¼‰

```
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§äºˆæ¸¬ã‚’å®Ÿè¡Œ
ãŒã€å®Ÿéš›ã«ã¯å£²è²·ã—ãªã„ã€‚
å¾Œã§ç²¾åº¦ã‚’æ¤œè¨¼ã€‚

æœŸé–“: æœ€åˆã®1-2é€±é–“
```

### å®Ÿéš›ã®å£²è²·ï¼ˆãƒ©ã‚¤ãƒ–ãƒˆãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼‰

```
âš ï¸ æ³¨æ„:
ã“ã®PoCã¯ã€Œãƒ©ã‚¤ãƒ–ãƒˆãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éå¯¾å¿œã€
å°†æ¥ã®å®Ÿè£…èª²é¡Œ
```

---

## ğŸ”® äºˆæ¸¬ãƒ—ãƒ­ã‚»ã‚¹ã®è©³ç´°

### äºˆæ¸¬æ™‚ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. æœ€æ–°ã®1åˆ†è¶³OHLC ã‚’å–å¾—
2. éå»60åˆ†åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’é›†ã‚ã‚‹
3. 14å€‹ã®ç‰¹å¾´é‡ã‚’è¨ˆç®—
4. LightGBMã«å…¥åŠ›
5. 3ã¤ã®ç¢ºç‡ (SHORT, LONG, NO_TRADE) ã‚’å‡ºåŠ›
6. æœ€å¤§ã®ç¢ºç‡ã®ã‚¯ãƒ©ã‚¹ã‚’è¿”ã™
7. ãã®ç¢ºç‡ã‚’ "confidence" ã¨ã—ã¦å ±å‘Š
```

### æ¨è«–ã®æ™‚é–“è¨ˆç®—é‡

```
ãƒ‡ãƒ¼ã‚¿å–å¾—:     O(1)   - æœ€æ–°1è¡Œ
ç‰¹å¾´é‡è¨ˆç®—:     O(60)  - éå»60åˆ†ã®è¨ˆç®—
LightGBMæ¨è«–:   O(d)   - ãƒ‡ãƒ—ã‚¹ Ã— ãƒ„ãƒªãƒ¼æ•°ï¼ˆéå¸¸ã«é«˜é€Ÿï¼‰

åˆè¨ˆ: < 1ç§’ï¼ˆé€šå¸¸ï¼‰
```

---

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¬ã‚¤ãƒ‰

### äºˆæ¸¬æœŸé–“ã‚’å¤‰æ›´

```python
# config.yaml
features:
  lookback_minutes: 120  # 60 â†’ 120åˆ†ã«å¤‰æ›´
```

### ãƒ©ãƒ™ãƒ«ã®é–¾å€¤ã‚’å¤‰æ›´

```python
# predict.py ã® classify_trend é–¢æ•°
if ret > 0.2:    # 0.1% â†’ 0.2% ã«å³ã—ãã™ã‚‹
    return 1  # LONG
```

### ãƒ¢ãƒ‡ãƒ«ã®ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æœ€é©åŒ–

```python
# train_model.py
lgb_params = {
    'num_leaves': 63,      # 31 â†’ 63 ã«è¤‡é›‘åŒ–
    'learning_rate': 0.01, # 0.05 â†’ 0.01 ã«ä½ä¸‹
}
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [LightGBM å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://lightgbm.readthedocs.io/)
- [scikit-learn åˆ†é¡è©•ä¾¡](https://scikit-learn.org/stable/modules/model_evaluation.html)
- [ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«åˆ†æãƒãƒ³ãƒ‰ãƒ–ãƒƒã‚¯](https://en.wikipedia.org/wiki/Technical_analysis)

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´2æœˆ7æ—¥  
**AI ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 0.1.0-PoC  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”§ é–‹ç™ºä¸­
